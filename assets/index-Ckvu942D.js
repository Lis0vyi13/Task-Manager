import{r as o,w as q,x as E,j as s,y as L,o as H,z as O,A as $,C as G,I as P,D as W,h as z}from"./index-CrHAFnCA.js";import{Q as V}from"./index-DO2vfCeJ.js";import{S as N}from"./index-CQcgwu5x.js";import{t as Q}from"./transformToInputDateType-9qsVDyqT.js";import{I as J,S as K}from"./index-DgDDtzeS.js";const X=[{value:"todo",label:"TODO"},{value:"in progress",label:"IN PROGRESS"},{value:"completed",label:"COMPLETED"}],Y=({changedValue:i,onClose:e,task:l})=>{const d=o.useMemo(()=>({stage:l!=null&&l.stage?{value:l.stage,label:l.stage.toUpperCase()}:""}),[l==null?void 0:l.stage]),{handleSubmit:m,reset:p,control:r}=q({mode:"onChange",defaultValues:d}),{onSubmitHandler:c,onCloseHandler:a}=E({onClose:e,reset:p}),u=o.useCallback(()=>{},[]);return s.jsx(L,{changedValue:i,noCross:!0,onSubmit:u,onClose:a,children:s.jsx("section",{className:"modalWrapper",children:s.jsxs("form",{onSubmit:m(c),children:[s.jsx(H,{className:"modalTitle",children:"Change task stage"}),s.jsx(N,{name:"stage",control:r,label:"Stage",rules:{required:"Stage is required"},placeholder:"Stage...",options:X}),s.jsx(O,{onSubmit:u,submitButtonText:"Submit",onClose:a})]})})})},Z=({summary:i,task:e})=>{const l=o.useMemo(()=>{var n;return{name:(e==null?void 0:e.title)||"",assignee:((n=e==null?void 0:e.team)==null?void 0:n.map(x=>({value:x._id,label:x.name})))||"",stage:e!=null&&e.stage?{value:e.stage,label:e.stage.toUpperCase()}:"",priority:e!=null&&e.priority?{value:e.priority,label:e.priority.toUpperCase()}:"",date:e!=null&&e.date?Q(e.date):"",assets:(e==null?void 0:e.assets)||[],description:(e==null?void 0:e.description)||"",links:e!=null&&e.links?e.links.join(","):""}},[e]),{handleSubmit:d,register:m,reset:p,control:r,setValue:c}=q({mode:"onChange",defaultValues:l}),[a,u]=o.useState((e==null?void 0:e.assets.length)||0),[g,C]=o.useState((e==null?void 0:e.assets)||[]),[_,f]=o.useState(""),D=o.useCallback(()=>f(null),[]),v=o.useCallback(n=>{f(n)},[]),M=o.useMemo(()=>i.users.map(n=>({value:n._id,label:n.name})),[i.users]),[I,B,j]=$(),[y,h]=o.useState(),S=o.useCallback(n=>{B(),h(n)},[B]),F=o.useCallback(n=>{C(x=>{const A=x.filter(b=>b!==n);return u(A.length),c("assets",A),A})},[c]),R=o.useCallback(()=>{F(y),j()},[j,F,y]),U=o.useCallback(n=>{const x=Array.from(n.target.files),A=x.map(b=>URL.createObjectURL(b));u(b=>b+x.length),C(b=>[...b,...A]),c("assets",[...g,...x])},[c,g]);return{users:M,handleSubmit:d,fileCount:a,register:m,control:r,handleFileChange:U,setValue:c,reset:p,filePreviews:g,selectedImg:_,handleCloseImg:D,handleImageClick:v,removeImageHandler:F,isDeleteModalOpen:I,openDeleteModal:S,onDeleteAsset:R,closeDeleteModal:j}},k="_label_dca6u_1",ee="_textArea_dca6u_6",se="_textAreaError_dca6u_21",le="_errorText_dca6u_25",T={label:k,textArea:ee,textAreaError:se,errorText:le},w=({name:i,control:e,label:l,rules:d,placeholder:m})=>{const{field:p,fieldState:{error:r}}=G({name:i,control:e,rules:d});return s.jsxs("div",{className:"inputBlock",children:[s.jsx("label",{className:T.label,children:l}),s.jsx("textarea",{...p,className:`${T.textArea} ${r?T.textAreaError:""}`,placeholder:m}),r&&s.jsx("p",{className:T.errorText,children:r.message})]})},te="_modal_if5cm_1",ae="_stagePriorityBlock_if5cm_7",oe="_dateAssetsBlock_if5cm_8",re="_priorityBlock_if5cm_22",ne="_dateBlock_if5cm_31",ie="_stageBlock_if5cm_32",ce="_addAssetsBlock_if5cm_34",de="_inputFile_if5cm_46",ue="_addAssetsLabel_if5cm_50",me="_preview_if5cm_72",pe="_image_if5cm_86",ge="_closeButton_if5cm_108",t={modal:te,stagePriorityBlock:ae,dateAssetsBlock:oe,priorityBlock:re,dateBlock:ne,stageBlock:ie,addAssetsBlock:ce,inputFile:de,addAssetsLabel:ue,preview:me,image:pe,closeButton:ge},xe=[{value:"todo",label:"TODO"},{value:"in progress",label:"IN PROGRESS"},{value:"completed",label:"COMPLETED"}],he=[{value:"low",label:"LOW"},{value:"normal",label:"NORMAL"},{value:"medium",label:"MEDIUM"},{value:"high",label:"HIGH"}],be=({onClose:i,className:e,task:l,changedValue:d})=>{const{users:m,handleSubmit:p,fileCount:r,register:c,control:a,handleFileChange:u,reset:g,filePreviews:C,selectedImg:_,handleCloseImg:f,handleImageClick:D,isDeleteModalOpen:v,openDeleteModal:M,onDeleteAsset:I,closeDeleteModal:B}=Z({summary:z,task:l}),{onCloseHandler:j,onSubmitHandler:y}=E({onClose:i,reset:g});return s.jsxs(L,{changedValue:d,className:e,noCross:!0,onClose:j,children:[s.jsxs("section",{className:`modalWrapper ${t.modal}`,children:[s.jsx(H,{className:"modalTitle",children:l?"Update task":"Add task"}),s.jsxs("form",{onSubmit:p(y),className:t.form,children:[s.jsx(P,{name:"name",control:a,label:"Task title",rules:{required:"Task title is required"},placeholder:"Title name"}),s.jsx(N,{name:"assignee",control:a,label:"Assign task to:",rules:{required:"Assign task to user is required"},options:m,isMulti:!0,placeholder:"Assign to..."}),s.jsxs("div",{className:t.stagePriorityBlock,children:[s.jsx("div",{className:t.stageBlock,children:s.jsx(N,{name:"stage",control:a,label:"Task stage",rules:{required:"Stage is required"},options:xe,placeholder:"Stage..."})}),s.jsx("div",{className:t.priorityBlock,children:s.jsx(N,{name:"priority",control:a,label:"Priority level",rules:{required:"Priority is required"},options:he,placeholder:"Priority..."})})]}),s.jsxs("div",{className:t.dateAssetsBlock,children:[s.jsx("div",{className:t.dateBlock,children:s.jsx(P,{name:"date",control:a,label:"Task date",type:"date",rules:{required:"Date is required"}})}),s.jsxs("div",{className:t.addAssetsBlock,children:[s.jsx("input",{type:"file",className:t.inputFile,id:"assets",...c("assets"),multiple:!0,onChange:h=>u(h)}),s.jsxs("label",{htmlFor:"assets",className:t.addAssetsLabel,children:[s.jsx(W,{className:t.addAssetsIcon}),s.jsxs("p",{className:t.addAssetsText,children:["Add assets",r>0&&s.jsxs("span",{children:[" (",r," files selected)"]})]})]})]})]}),C.length>0&&s.jsx("div",{className:t.preview,children:C.map((h,S)=>s.jsxs("div",{className:t.image,children:[s.jsx("img",{onClick:()=>D(h),src:h,alt:`Asset ${S+1}`}),s.jsx("button",{className:t.closeButton,onClick:()=>M(h),children:"Ã—"})]},S))}),s.jsx(w,{name:"description",control:a,label:"Task Description",placeholder:"Describe the task..."}),s.jsx(w,{name:"links",control:a,label:"Add links (separated by commas ',')",placeholder:"Add some links..."}),s.jsx(O,{onClose:j})]})]}),_&&s.jsx(J,{changedValue:_,onClose:f,src:_,alt:_}),v&&s.jsx(V,{onSubmit:I,changedValue:v,onClose:B,text:"Are you sure you want to delete current asset?",type:"delete",submitButtonText:"Delete"})]})},ve=({task:i,isEditModalOpen:e,closeEditModal:l,isAddSubtaskModalOpen:d,closeAddSubtaskModal:m,onAddSubtaskHandler:p,isQuestionModalOpen:r,closeQuestionModal:c,onDeleteTaskHandler:a,isStageModalOpen:u,closeStageModal:g})=>s.jsxs(s.Fragment,{children:[e&&s.jsx(be,{onClose:l,changedValue:e,task:i}),d&&s.jsx(K,{changedValue:d,onClose:m,onSubmit:p}),r&&s.jsx(V,{changedValue:r,onClose:c,task:i,onSubmit:a,type:"delete",text:"Are you sure you want to delete the selected task?",submitButtonText:"Delete"}),u&&s.jsx(Y,{changedValue:u,onClose:g,onSubmit:g,task:i})]});export{ve as T,be as a};
