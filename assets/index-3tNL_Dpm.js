import{r as o,w as q,x as E,j as s,y as L,o as H,z as O,A as $,C as G,I as P,D as W,h as z}from"./index-D_pLHn6N.js";import{Q as V}from"./index-4a46P04U.js";import{S as f}from"./index-Cl5nAM8q.js";import{t as Q}from"./transformToInputDateType-DiPkNHw2.js";import{I as J,S as K}from"./index-B3g5e5vR.js";const X=[{value:"todo",label:"TODO"},{value:"in progress",label:"IN PROGRESS"},{value:"completed",label:"COMPLETED"}],Y=({changedValue:i,onClose:e,task:l})=>{const d=o.useMemo(()=>({stage:l!=null&&l.stage?{value:l.stage,label:l.stage.toUpperCase()}:""}),[l==null?void 0:l.stage]),{handleSubmit:m,reset:p,control:r}=q({mode:"onChange",defaultValues:d}),{onSubmitHandler:c,onCloseHandler:a}=E({onClose:e,reset:p}),u=o.useCallback(()=>{},[]);return s.jsx(L,{changedValue:i,noCross:!0,onSubmit:u,onClose:a,children:s.jsx("section",{className:"modalWrapper",children:s.jsxs("form",{onSubmit:m(c),children:[s.jsx(H,{className:"modalTitle",children:"Change task stage"}),s.jsx(f,{name:"stage",control:r,label:"Stage",rules:{required:"Stage is required"},placeholder:"Stage...",options:X}),s.jsx(O,{onSubmit:u,submitButtonText:"Submit",onClose:a})]})})})},Z=({summary:i,task:e})=>{const l=o.useMemo(()=>{var n;return{name:(e==null?void 0:e.title)||"",assignee:((n=e==null?void 0:e.team)==null?void 0:n.map(b=>({value:b._id,label:b.name})))||"",stage:e!=null&&e.stage?{value:e.stage,label:e.stage.toUpperCase()}:"",priority:e!=null&&e.priority?{value:e.priority,label:e.priority.toUpperCase()}:"",date:e!=null&&e.date?Q(e.date):"",assets:(e==null?void 0:e.assets)||[],description:(e==null?void 0:e.description)||"",links:e!=null&&e.links?e.links.join(","):""}},[e]),{handleSubmit:d,register:m,reset:p,control:r,setValue:c}=q({mode:"onChange",defaultValues:l}),[a,u]=o.useState((e==null?void 0:e.assets.length)||0),[g,C]=o.useState((e==null?void 0:e.assets)||[]),[h,v]=o.useState(""),D=o.useCallback(()=>v(null),[]),B=o.useCallback(n=>{v(n)},[]),M=o.useMemo(()=>i.users.map(n=>({value:n._id,label:n.name})),[i.users]),[I,y,_]=$(),[S,j]=o.useState(),T=o.useCallback(n=>{y(),j(n)},[y]),F=o.useCallback(n=>{C(b=>{const A=b.filter(x=>x!==n);return u(A.length),c("assets",A),A})},[c]),R=o.useCallback(()=>{F(S),_()},[_,F,S]),U=o.useCallback(n=>{const b=Array.from(n.target.files),A=b.map(x=>URL.createObjectURL(x));u(x=>x+b.length),C(x=>[...x,...A]),c("assets",[...g,...b])},[c,g]);return{users:M,handleSubmit:d,fileCount:a,register:m,control:r,handleFileChange:U,setValue:c,reset:p,filePreviews:g,selectedImg:h,handleCloseImg:D,handleImageClick:B,removeImageHandler:F,isDeleteModalOpen:I,openDeleteModal:T,onDeleteAsset:R,closeDeleteModal:_}},k="_label_dca6u_1",ee="_textArea_dca6u_6",se="_textAreaError_dca6u_21",le="_errorText_dca6u_25",N={label:k,textArea:ee,textAreaError:se,errorText:le},w=({name:i,control:e,label:l,rules:d,placeholder:m})=>{const{field:p,fieldState:{error:r}}=G({name:i,control:e,rules:d});return s.jsxs("div",{className:"inputBlock",children:[s.jsx("label",{className:N.label,children:l}),s.jsx("textarea",{...p,className:`${N.textArea} ${r?N.textAreaError:""}`,placeholder:m}),r&&s.jsx("p",{className:N.errorText,children:r.message})]})},te="_modal_1ibn6_1",ae="_stagePriorityBlock_1ibn6_7",oe="_dateAssetsBlock_1ibn6_8",re="_priorityBlock_1ibn6_22",ne="_dateBlock_1ibn6_31",ie="_stageBlock_1ibn6_32",ce="_addAssetsBlock_1ibn6_34",de="_inputFile_1ibn6_46",ue="_addAssetsLabel_1ibn6_50",me="_preview_1ibn6_72",pe="_image_1ibn6_82",ge="_closeButton_1ibn6_93",t={modal:te,stagePriorityBlock:ae,dateAssetsBlock:oe,priorityBlock:re,dateBlock:ne,stageBlock:ie,addAssetsBlock:ce,inputFile:de,addAssetsLabel:ue,preview:me,image:pe,closeButton:ge},be=[{value:"todo",label:"TODO"},{value:"in progress",label:"IN PROGRESS"},{value:"completed",label:"COMPLETED"}],xe=[{value:"low",label:"LOW"},{value:"normal",label:"NORMAL"},{value:"medium",label:"MEDIUM"},{value:"high",label:"HIGH"}],he=({onClose:i,className:e,task:l,changedValue:d})=>{const{users:m,handleSubmit:p,fileCount:r,register:c,control:a,handleFileChange:u,reset:g,filePreviews:C,selectedImg:h,handleCloseImg:v,handleImageClick:D,isDeleteModalOpen:B,openDeleteModal:M,onDeleteAsset:I,closeDeleteModal:y}=Z({summary:z,task:l}),{onCloseHandler:_,onSubmitHandler:S}=E({onClose:i,reset:g});return s.jsxs(L,{changedValue:d,className:e,noCross:!0,onClose:_,children:[s.jsxs("section",{className:`modalWrapper ${t.modal}`,children:[s.jsx(H,{className:"modalTitle",children:l?"Update task":"Add task"}),s.jsxs("form",{onSubmit:p(S),className:t.form,children:[s.jsx(P,{name:"name",control:a,label:"Task title",rules:{required:"Task title is required"},placeholder:"Title name"}),s.jsx(f,{name:"assignee",control:a,label:"Assign task to:",rules:{required:"Assign task to user is required"},options:m,isMulti:!0,placeholder:"Assign to..."}),s.jsxs("div",{className:t.stagePriorityBlock,children:[s.jsx("div",{className:t.stageBlock,children:s.jsx(f,{name:"stage",control:a,label:"Task stage",rules:{required:"Stage is required"},options:be,placeholder:"Stage..."})}),s.jsx("div",{className:t.priorityBlock,children:s.jsx(f,{name:"priority",control:a,label:"Priority level",rules:{required:"Priority is required"},options:xe,placeholder:"Priority..."})})]}),s.jsxs("div",{className:t.dateAssetsBlock,children:[s.jsx("div",{className:t.dateBlock,children:s.jsx(P,{name:"date",control:a,label:"Task date",type:"date",rules:{required:"Date is required"}})}),s.jsxs("div",{className:t.addAssetsBlock,children:[s.jsx("input",{type:"file",className:t.inputFile,id:"assets",...c("assets"),multiple:!0,onChange:j=>u(j)}),s.jsxs("label",{htmlFor:"assets",className:t.addAssetsLabel,children:[s.jsx(W,{className:t.addAssetsIcon}),s.jsxs("p",{className:t.addAssetsText,children:["Add assets",r>0&&s.jsxs("span",{children:[" (",r," files selected)"]})]})]})]})]}),C.length>0&&s.jsx("div",{className:t.preview,children:C.map((j,T)=>s.jsxs("div",{className:t.image,children:[s.jsx("img",{onClick:D,src:j,alt:`Asset ${T+1}`}),s.jsx("button",{className:t.closeButton,onClick:()=>M(j),children:"Ã—"})]},T))}),s.jsx(w,{name:"description",control:a,label:"Task Description",placeholder:"Describe the task..."}),s.jsx(w,{name:"links",control:a,label:"Add links (separated by commas ',')",placeholder:"Add some links..."}),s.jsx(O,{onClose:_})]})]}),h&&s.jsx(J,{changedValue:h,onClose:v,src:h,alt:h}),B&&s.jsx(V,{onSubmit:I,changedValue:B,onClose:y,text:"Are you sure you want to delete current asset?",type:"delete"})]})},Be=({task:i,isEditModalOpen:e,closeEditModal:l,isAddSubtaskModalOpen:d,closeAddSubtaskModal:m,onAddSubtaskHandler:p,isQuestionModalOpen:r,closeQuestionModal:c,onDeleteTaskHandler:a,isStageModalOpen:u,closeStageModal:g})=>s.jsxs(s.Fragment,{children:[e&&s.jsx(he,{onClose:l,changedValue:e,task:i}),d&&s.jsx(K,{changedValue:d,onClose:m,onSubmit:p}),r&&s.jsx(V,{changedValue:r,onClose:c,task:i,onSubmit:a,type:"delete",text:"Are you sure you want to delete the selected task?",submitButtonText:"Delete"}),u&&s.jsx(Y,{changedValue:u,onClose:g,onSubmit:g,task:i})]});export{Be as T,he as a};
